const startBtn = document.getElementById("startBtn");
const flame = document.getElementById("flame");
const surprise = document.getElementById("surprise");

startBtn.addEventListener("click", async () => {
  startBtn.innerText = "Blow now ðŸ’¨";

  const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
  const audioContext = new AudioContext();
  const mic = audioContext.createMediaStreamSource(stream);
  const analyser = audioContext.createAnalyser();

  mic.connect(analyser);
  analyser.fftSize = 256;

  const data = new Uint8Array(analyser.frequencyBinCount);

  function detectBlow() {
    analyser.getByteFrequencyData(data);
    let volume = data.reduce((a, b) => a + b) / data.length;

    if (volume > 40) {
      flame.style.display = "none";
      surprise.style.display = "block";
      stream.getTracks().forEach(track => track.stop());
    } else {
      requestAnimationFrame(detectBlow);
    }
  }

  detectBlow();
});